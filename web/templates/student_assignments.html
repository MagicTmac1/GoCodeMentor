<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­¦ç”Ÿä½œä¸šæƒ…å†µ - GoCodeMentor</title>
    <link rel="stylesheet" href="/static/css/main.css">
    <style>
        body { background-color: #f8fafc; margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; color: #1e293b; line-height: 1.5; }
        .student-assignments-container { max-width: 1200px; margin: 0 auto; padding: 40px 20px; }
        
        /* æ•´åˆå¼å¤´éƒ¨å¯¼èˆª */
        .page-header { 
            background: white; 
            border-radius: 24px; 
            padding: 32px; 
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.02), 0 10px 15px -3px rgba(0,0,0,0.03); 
            margin-bottom: 40px; 
            border: 1px solid #f1f5f9;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            overflow: hidden;
        }
        
        /* èƒŒæ™¯è£…é¥° */
        .page-header::before {
            content: '';
            position: absolute;
            top: -50px;
            right: -50px;
            width: 200px;
            height: 200px;
            background: linear-gradient(135deg, rgba(79, 70, 229, 0.05) 0%, rgba(124, 58, 237, 0.05) 100%);
            border-radius: 50%;
            z-index: 0;
        }

        .header-left { display: flex; align-items: center; gap: 24px; position: relative; z-index: 1; }
        
        .back-btn { 
            width: 48px;
            height: 48px;
            display: flex; 
            align-items: center; 
            justify-content: center;
            background: #f8fafc; 
            border: 1px solid #e2e8f0; 
            border-radius: 14px; 
            color: #64748b; 
            text-decoration: none; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .back-btn:hover { 
            background: #4f46e5; 
            color: white; 
            border-color: #4f46e5;
            transform: translateX(-4px);
            box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.2);
        }

        .student-avatar { 
            width: 80px; 
            height: 80px; 
            border-radius: 22px; 
            background: linear-gradient(135deg, #4f46e5, #7c3aed); 
            color: white; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 36px; 
            font-weight: 800; 
            box-shadow: 0 20px 25px -5px rgba(79, 70, 229, 0.2);
        }

        .student-info h2 { margin: 0; color: #0f172a; font-size: 28px; font-weight: 800; letter-spacing: -0.025em; }
        .student-info p { margin: 8px 0 0; color: #64748b; font-size: 15px; font-weight: 500; display: flex; align-items: center; gap: 6px; }
        .student-info p::before { content: 'ğŸ«'; font-size: 14px; }

        .header-right { text-align: right; position: relative; z-index: 1; }
        .stats-label { font-size: 13px; color: #94a3b8; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 4px; display: block; }
        .stats-value { font-size: 24px; color: #0f172a; font-weight: 800; }

        /* ä½œä¸šåˆ—è¡¨æ ‡é¢˜åŒºåŸŸ */
        .section-title { 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            margin-bottom: 24px;
            padding: 0 8px;
        }
        .section-title h3 { font-size: 20px; font-weight: 700; color: #0f172a; margin: 0; }
        .section-title span { font-size: 14px; color: #64748b; font-weight: 500; }

        /* å¡ç‰‡ç½‘æ ¼ */
        .assignments-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(360px, 1fr)); gap: 28px; }
        
        .assignment-card { 
            background: white; 
            border-radius: 24px; 
            padding: 32px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.05); 
            border: 1px solid #f1f5f9; 
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
            position: relative;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .assignment-card:hover { 
            transform: translateY(-8px); 
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.08); 
            border-color: #e2e8f0;
        }
        
        /* é¡¶éƒ¨è£…é¥°æ¡ */
        .card-accent {
            position: absolute;
            top: 0;
            left: 32px;
            right: 32px;
            height: 4px;
            border-radius: 0 0 4px 4px;
            background: #e2e8f0;
        }
        .status-graded .card-accent { background: #10b981; }
        .status-submitted .card-accent { background: #f59e0b; }
        .status-unsubmitted .card-accent { background: #ef4444; }

        .card-header { display: flex; justify-content: space-between; align-items: flex-start; }
        .type-tag { 
            padding: 6px 12px; 
            background: #f1f5f9; 
            border-radius: 8px; 
            font-size: 12px; 
            font-weight: 700; 
            color: #64748b;
            text-transform: uppercase;
        }
        
        .status-badge {
            font-size: 12px;
            font-weight: 700;
            padding: 6px 12px;
            border-radius: 8px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        .status-graded .status-badge { background: #ecfdf5; color: #059669; }
        .status-submitted .status-badge { background: #fffbeb; color: #d97706; }
        .status-unsubmitted .status-badge { background: #fef2f2; color: #dc2626; }

        .assignment-card h4 { margin: 0; color: #0f172a; font-size: 20px; line-height: 1.4; font-weight: 700; }
        
        .card-footer { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-top: auto;
            padding-top: 20px;
            border-top: 1px solid #f1f5f9;
        }
        
        .score-box { text-align: left; }
        .score-label { font-size: 12px; color: #94a3b8; font-weight: 600; display: block; margin-bottom: 2px; }
        .score-value { font-size: 20px; font-weight: 800; color: #4f46e5; }

        .view-btn { 
            background: #4f46e5; 
            color: white; 
            border: none; 
            padding: 12px 20px; 
            border-radius: 12px; 
            cursor: pointer; 
            font-weight: 600; 
            font-size: 14px;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .view-btn:hover { background: #4338ca; box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.3); }
        .view-btn svg { transition: transform 0.2s; }
        .view-btn:hover svg { transform: translateX(3px); }

        /* æ¨¡æ€æ¡† - ä¼˜åŒ–è®¾è®¡ */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); }
        .modal-content { background: white; margin: 5% auto; padding: 0; border-radius: 15px; width: 90%; max-width: 900px; max-height: 90vh; overflow-y: auto; box-shadow: 0 20px 40px rgba(0,0,0,0.2); }
        
        /* æ¨¡æ€æ¡†å¤´éƒ¨ - æ•™å¸ˆä¸“ç”¨ä¸»é¢˜ï¼ˆå¢å¼ºç‰ˆï¼‰ */
        .modal-header { 
            background: linear-gradient(135deg, #9c27b0, #673ab7); 
            color: white; 
            padding: 25px 30px; 
            border-radius: 15px 15px 0 0; 
            border-bottom: 6px solid #ff9800; 
            position: relative; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .modal-header h3 { 
            margin: 0; 
            font-size: 22px; 
            display: flex; 
            align-items: center; 
            gap: 15px; 
            font-weight: 600;
        }
        .modal-header .close-btn { 
            position: absolute; 
            right: 25px; 
            top: 25px; 
            background: rgba(255,255,255,0.2); 
            border: none; 
            border-radius: 50%; 
            width: 36px; 
            height: 36px; 
            cursor: pointer; 
            font-size: 20px; 
            color: white; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            transition: all 0.2s;
        }
        .modal-header .close-btn:hover { 
            background: rgba(255,255,255,0.3); 
            transform: scale(1.1);
        }
        .teacher-badge { 
            background: linear-gradient(135deg, #ff9800, #ff5722); 
            color: white; 
            font-size: 12px; 
            font-weight: bold; 
            padding: 5px 15px; 
            border-radius: 15px; 
            position: absolute; 
            top: 20px; 
            left: 30px; 
            letter-spacing: 1px;
            box-shadow: 0 2px 8px rgba(255, 152, 0, 0.3);
        }
        
        /* æ¨¡æ€æ¡†å†…å®¹åŒºåŸŸ */
        .modal-body { padding: 35px; }
        
        /* ä½œä¸šä¿¡æ¯å¡ç‰‡ - å¢å¼ºï¼ˆæ•™å¸ˆä¸“ç”¨ï¼‰ */
        .assignment-info-card { 
            background: linear-gradient(to right, #f8f9fa, #e9ecef); 
            padding: 25px; 
            border-radius: 12px; 
            margin-bottom: 30px; 
            border-left: 6px solid #4f46e5; 
            box-shadow: 0 3px 10px rgba(79, 70, 229, 0.05);
        }
        .assignment-info-card h4 { 
            margin: 0 0 15px; 
            color: #0f172a; 
            font-size: 22px; 
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .assignment-info-card .assignment-title { 
            color: #4f46e5; 
            font-size: 24px; 
            margin-bottom: 10px;
        }
        .assignment-info-card p { 
            margin: 10px 0; 
            color: #555; 
            font-size: 16px;
            line-height: 1.6;
        }
        .assignment-info-card strong { 
            color: #333; 
            min-width: 100px; 
            display: inline-block;
            font-weight: 600;
        }
        
        /* æäº¤çŠ¶æ€å¡ç‰‡ - å¢å¼ºæœªæäº¤çŠ¶æ€ï¼ˆæ•™å¸ˆä¸“ç”¨ï¼‰ */
        .submission-status-card { 
            padding: 25px; 
            border-radius: 12px; 
            margin-bottom: 30px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        .submission-status-not-submitted { 
            background: linear-gradient(to right, #fff3cd, #ffeaa7); 
            border-left: 6px solid #dc3545; 
        }
        .submission-status-submitted { 
            background: linear-gradient(to right, #eef2ff, #e0e7ff); 
            border-left: 6px solid #4f46e5; 
        }
        .submission-status-graded { 
            background: linear-gradient(to right, #ecfdf5, #d1fae5); 
            border-left: 6px solid #10b981; 
        }
        .status-content h4 { 
            margin: 0 0 10px; 
            font-size: 18px; 
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .status-content p { 
            margin: 5px 0 0; 
            font-size: 15px; 
            line-height: 1.5;
        }
        .score-display { 
            background: white; 
            padding: 12px 24px; 
            border-radius: 10px; 
            font-size: 28px; 
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            min-width: 120px;
            text-align: center;
        }
        .score-not-submitted { 
            color: #ef4444; 
            background: #fee2e2;
        }
        .score-submitted { 
            color: #4f46e5; 
            background: #eef2ff;
        }
        .score-graded { 
            color: #10b981; 
            background: #ecfdf5;
        }
        
        /* AIæ‰¹æ”¹åé¦ˆ */
        .ai-feedback-card { background: #e8f5e9; padding: 20px; border-radius: 10px; margin-bottom: 25px; border-left: 4px solid #2ecc71; }
        .ai-feedback-card h4 { margin: 0 0 10px; color: #2d3436; font-size: 16px; display: flex; align-items: center; gap: 8px; }
        .feedback-content { white-space: pre-wrap; color: #388e3c; background: white; padding: 15px; border-radius: 8px; border: 1px solid #c8e6c9; font-size: 14px; line-height: 1.5; }
        
        /* è¯¦ç»†è¯„åˆ† */
        .detailed-score-card { margin-bottom: 25px; }
        .detailed-score-card h4 { margin: 0 0 15px; color: #2d3436; font-size: 16px; }
        .score-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; }
        .score-item { background: white; border: 1px solid #e0e0e0; border-radius: 8px; padding: 12px; text-align: center; }
        .score-category { font-size: 12px; color: #666; margin-bottom: 5px; }
        .score-value { font-size: 18px; font-weight: bold; color: #333; }
        
        /* é¢˜ç›®å¯¹æ¯”åŒºåŸŸ */
        .questions-section h4 { margin: 0 0 20px; color: #2d3436; font-size: 18px; padding-bottom: 10px; border-bottom: 2px solid #f1f2f6; }
        .question-item { border: 1px solid #eee; border-radius: 10px; padding: 20px; margin-bottom: 20px; background: white; }
        .question-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px; }
        .question-header h5 { margin: 0; color: #2d3436; font-size: 16px; }
        .question-score { background: #f8f9fa; color: #666; padding: 4px 10px; border-radius: 4px; font-size: 12px; }
        .answers-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .answer-card { padding: 15px; border-radius: 8px; }
        .student-answer-card { background: #f8f9fa; }
        .correct-answer-card { background: #e8f5e9; }
        .answer-label { font-size: 13px; color: #666; margin-bottom: 8px; display: flex; align-items: center; gap: 5px; }
        .answer-content { color: #333; font-size: 14px; line-height: 1.5; }
        .student-answer-content { color: #333; }
        .correct-answer-content { color: #2e7d32; font-weight: 500; }
        
        /* ä»£ç æ˜¾ç¤º */
        .code-section { margin-bottom: 25px; }
        .code-section h4 { margin: 0 0 10px; color: #2d3436; font-size: 16px; }
        .code-content { background: #2d3436; color: #dfe6e9; padding: 20px; border-radius: 8px; overflow: auto; font-family: 'Consolas', 'Monaco', monospace; font-size: 13px; line-height: 1.5; white-space: pre-wrap; word-wrap: break-word; }
        
        /* æˆªæ­¢æ—¶é—´æç¤º */
        .deadline-info { background: #fff3cd; border-left: 4px solid #ffc107; padding: 12px 15px; border-radius: 6px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .deadline-info.warning { background: #ffeaa7; border-left-color: #e74c3c; }
        .deadline-icon { font-size: 18px; }
        .deadline-text { font-size: 14px; }
    </style>
</head>
<body>
    <div class="student-assignments-container">
        <header class="page-header">
            <div class="header-left">
                <a href="javascript:history.back()" class="back-btn" title="è¿”å›ä¸Šä¸€çº§">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                </a>
                <div class="student-avatar" id="studentAvatar">?</div>
                <div class="student-info">
                    <h2 id="studentName">åŠ è½½ä¸­...</h2>
                    <p id="studentClass">æ‰€å±ç­çº§ï¼š-</p>
                </div>
            </div>
            <div class="header-right">
                <span class="stats-label">å·²æäº¤ä½œä¸š</span>
                <div class="stats-value" id="assignmentCount">0</div>
            </div>
        </header>

        <div class="section-title">
            <h3>ä½œä¸šè®°å½•</h3>
            <span id="updateTime">æœ€åæ›´æ–°: åˆšåˆš</span>
        </div>

        <div class="assignments-grid" id="assignmentsList">
            <!-- åŠ¨æ€åŠ è½½å†…å®¹ -->
        </div>
    </div>

            <!-- è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div id="assignmentModal" class="modal">
        <div class="modal-content">
                <div class="modal-header">
                    <div class="teacher-badge">æ•™å¸ˆä¸“ç”¨</div>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <div style="background: rgba(255,255,255,0.2); width: 48px; height: 48px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px;">
                            ğŸ‘¨â€ğŸ«
                        </div>
                        <div>
                            <h3 id="modalTitle" style="margin: 0; font-size: 22px; font-weight: 600;">ä½œä¸šæ‰¹æ”¹è¯¦æƒ…</h3>
                            <p id="modalSubtitle" style="margin: 5px 0 0; font-size: 14px; opacity: 0.9;">
                                æŸ¥çœ‹å­¦ç”Ÿä½œä¸šæäº¤æƒ…å†µï¼Œå¯¹æ¯”å­¦ç”Ÿç­”æ¡ˆä¸æ ‡å‡†ç­”æ¡ˆ
                            </p>
                        </div>
                    </div>
                    <button class="close-btn" onclick="closeModal()">&times;</button>
                </div>
            <div id="modalBody">åŠ è½½ä¸­...</div>
        </div>
    </div>

    <script>
        let currentStudent = null;
        let currentAssignments = [];
        let pollInterval = null;
        let isPolling = false;
        const POLL_INTERVAL = 30000; // 30ç§’

        // å¯åŠ¨è½®è¯¢
        function startPolling(assignmentId, studentId) {
            if (isPolling) {
                stopPolling();
            }
            isPolling = true;
            pollInterval = setInterval(() => {
                pollAssignmentStatus(assignmentId, studentId);
            }, POLL_INTERVAL);
            console.log('è½®è¯¢å·²å¯åŠ¨');
        }
        
        // åœæ­¢è½®è¯¢
        function stopPolling() {
            if (pollInterval) {
                clearInterval(pollInterval);
                pollInterval = null;
            }
            isPolling = false;
            console.log('è½®è¯¢å·²åœæ­¢');
        }
        
        // è½®è¯¢è·å–ä½œä¸šçŠ¶æ€
        async function pollAssignmentStatus(assignmentId, studentId) {
            try {
                const response = await fetch(`/api/assignments/${assignmentId}/student/${studentId}`, {
                    headers: {
                        'X-User-ID': getCookie('user_id'),
                        'X-User-Role': getCookie('user_role')
                    }
                });
                
                if (!response.ok) {
                    console.warn('è½®è¯¢è¯·æ±‚å¤±è´¥:', response.status);
                    return;
                }
                
                const data = await response.json();
                const submission = data.submission || data.Submission || {};
                
                // æ£€æŸ¥çŠ¶æ€æ˜¯å¦æœ‰å˜åŒ–
                const modalBody = document.getElementById('modalBody');
                const modalTitle = document.getElementById('modalTitle');
                const modalSubtitle = document.getElementById('modalSubtitle');
                
                // å¦‚æœæ¨¡æ€æ¡†ä»ç„¶æ‰“å¼€ï¼Œä¸”ä½œä¸šçŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œåˆ™æ›´æ–°æ˜¾ç¤º
                if (modalBody && modalTitle && modalSubtitle && 
                    document.getElementById('assignmentModal').style.display === 'block') {
                    
                    // åˆ¤æ–­çŠ¶æ€æ˜¯å¦ä»"æœªæäº¤"å˜ä¸º"å·²æäº¤"æˆ–"å·²æ‰¹æ”¹"
                    const currentSubmissionElement = modalBody.querySelector('.submission-status-card');
                    let currentStatus = '';
                    if (currentSubmissionElement) {
                        if (currentSubmissionElement.classList.contains('submission-status-not-submitted')) {
                            currentStatus = 'not_submitted';
                        } else if (currentSubmissionElement.classList.contains('submission-status-submitted')) {
                            currentStatus = 'submitted';
                        } else if (currentSubmissionElement.classList.contains('submission-status-graded')) {
                            currentStatus = 'graded';
                        }
                    }
                    
                    const newStatus = submission.submitted === false || !submission.submitted ? 'not_submitted' : 
                                     submission.status === 'graded' ? 'graded' : 'submitted';
                    
                    // å¦‚æœçŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œé‡æ–°åŠ è½½è¯¦æƒ…
                    if (currentStatus !== newStatus) {
                        console.log(`ä½œä¸šçŠ¶æ€å‘ç”Ÿå˜åŒ–: ${currentStatus} -> ${newStatus}ï¼Œé‡æ–°åŠ è½½è¯¦æƒ…`);
                        showAssignmentDetails(assignmentId); // é‡æ–°åŠ è½½è¯¦æƒ…
                    } else if (newStatus === 'submitted' && submission.status !== 'graded') {
                        // å¦‚æœæ˜¯"å·²æäº¤"çŠ¶æ€ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰AIæ‰¹æ”¹åé¦ˆ
                        const hasAIFeedback = modalBody.querySelector('.ai-feedback-card');
                        if (!hasAIFeedback && submission.ai_feedback) {
                            console.log('æ£€æµ‹åˆ°æ–°çš„AIæ‰¹æ”¹åé¦ˆï¼Œé‡æ–°åŠ è½½è¯¦æƒ…');
                            showAssignmentDetails(assignmentId); // é‡æ–°åŠ è½½è¯¦æƒ…
                        }
                    }
                }
                
            } catch (error) {
                console.warn('è½®è¯¢å¤±è´¥:', error);
            }
        }

        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return '';
        }

        // è½¬ä¹‰HTMLç‰¹æ®Šå­—ç¬¦
        function escapeHtml(text) {
            const map = {
                '&': '&',
                '<': '<',
                '>': '>',
                '"': '"',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, function(m) { return map[m]; });
        }

        // æ ¼å¼åŒ–ä»£ç æ˜¾ç¤º - ä¿ç•™ç¼©è¿›å¹¶æ·»åŠ åŸºæœ¬è¯­æ³•é«˜äº®
        function formatCode(code, language = 'go') {
            if (!code) return '';
            
            // é¦–å…ˆè½¬ä¹‰HTMLç‰¹æ®Šå­—ç¬¦
            let escaped = escapeHtml(code);
            
            // ä¿ç•™åŸå§‹ç¼©è¿›ï¼ˆwhite-space: pre-wrap ä¼šå¤„ç†ï¼‰
            return escaped;
        }

        // æ¸²æŸ“å­¦ç”ŸåŸºç¡€ä¿¡æ¯
        function renderStudentInfo() {
            if (!currentStudent) return;
            const name = currentStudent.Name || currentStudent.name || "æœªå®šä¹‰å§“å";
            const classId = currentStudent.ClassID || currentStudent.class_id || "æœªåˆ†é…ç­çº§";
            
            document.getElementById('studentName').textContent = name;
            document.getElementById('studentClass').textContent = `æ‰€å±ç­çº§ï¼š${classId}`;
            document.getElementById('studentAvatar').textContent = name.charAt(0).toUpperCase();
        }

        // æ¸²æŸ“ä½œä¸šå¡ç‰‡
        function renderAssignments() {
            const assignmentsList = document.getElementById('assignmentsList');
            assignmentsList.innerHTML = '';
            
            if (!currentAssignments || currentAssignments.length === 0) {
                assignmentsList.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 80px 20px; background: white; border-radius: 24px; border: 2px dashed #e2e8f0;">
                        <div style="font-size: 48px; margin-bottom: 20px;">ğŸ“š</div>
                        <div style="font-size: 18px; font-weight: 600; color: #0f172a;">æš‚æ— ä½œä¸šè®°å½•</div>
                        <p style="color: #64748b; margin-top: 8px;">è¯¥å­¦ç”Ÿç›®å‰è¿˜æ²¡æœ‰ä»»ä½•ä½œä¸šåˆ†é…æˆ–æäº¤è®°å½•</p>
                    </div>
                `;
                return;
            }

            currentAssignments.forEach((item, index) => {
                const assign = item.assignment || item.Assignment || item;
                const sub = item.submission || item.Submission || {};
                const status = (item.status || item.Status || 'unsubmitted').toLowerCase();
                
                const title = assign.title || assign.Title || assign.Name || assign.name || "æœªå‘½åä½œä¸š";
                const type = assign.type || assign.Type || "å¸¸è§„";
                const id = assign.id || assign.ID || "";
                
                const score = sub.total_score !== undefined ? sub.total_score : (sub.TotalScore !== undefined ? sub.TotalScore : 'æœªè¯„åˆ†');
                
                const statusText = (status === 'graded' || status === 'å·²æŸ¥çœ‹') ? 'å·²æ‰¹æ”¹' : 
                                 ((status === 'submitted' || status === 'å·²æäº¤') ? 'å¾…æ‰¹æ”¹' : 'æœªæäº¤');
                const statusIcon = (status === 'graded' || status === 'å·²æŸ¥çœ‹') ? 
                    '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>' : 
                    '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>';

                const card = document.createElement('div');
                card.className = `assignment-card status-${status}`;
                card.innerHTML = `
                    <div class="card-accent"></div>
                    <div class="card-header">
                        <span class="type-tag">${type}</span>
                        <span class="status-badge">${statusIcon}${statusText}</span>
                    </div>
                    <h4>${title}</h4>
                    <div class="card-footer">
                        <div class="score-box">
                            <span class="score-label">ä½œä¸šå¾—åˆ†</span>
                            <span class="score-value">${score}</span>
                        </div>
                        <button class="view-btn" onclick="showAssignmentDetails('${id}')">
                            æŸ¥çœ‹è¯¦æƒ…
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>
                        </button>
                    </div>
                `;
                assignmentsList.appendChild(card);
            });
            
            // æ›´æ–°ç»Ÿè®¡
            document.getElementById('assignmentCount').textContent = currentAssignments.length;
            document.getElementById('updateTime').textContent = `æœ€åæ›´æ–°: ${new Date().toLocaleTimeString()}`;
        }

        // è·å–å¹¶å±•ç¤ºä½œä¸šè¯¦æƒ…
        async function showAssignmentDetails(assignmentId) {
            if (!assignmentId || assignmentId === "undefined") {
                console.warn("æ— æ³•æŸ¥è¯¢è¯¦æƒ…ï¼šæ­¤é¡¹æ²¡æœ‰æœ‰æ•ˆçš„ AssignmentID");
                return;
            }
            const modal = document.getElementById('assignmentModal');
            const body = document.getElementById('modalBody');
            modal.style.display = 'block';
            body.innerHTML = '<div style="text-align:center; padding:20px;">æ­£åœ¨è·å–æ‰¹æ”¹è¯¦æƒ…...</div>';

            try {
                const studentId = new URLSearchParams(window.location.search).get('studentId');
                const response = await fetch(`/api/assignments/${assignmentId}/student/${studentId}`, {
                    headers: {
                        'X-User-ID': getCookie('user_id'),
                        'X-User-Role': getCookie('user_role')
                    }
                });
                const data = await response.json();
                
        const userRole = getCookie('user_role');
        const isTeacher = userRole === 'teacher';
        
        const assignInfo = data.assignment || data.Assignment || {};
        const questions = data.questions || data.Questions || [];
        const submission = data.submission || data.Submission || {};
        
        // è®¾ç½®å¼¹çª—æ ‡é¢˜ - æ•™å¸ˆä¸“ç”¨
        document.getElementById('modalTitle').textContent = 'æ•™å¸ˆæ‰¹æ”¹ - ' + (assignInfo.title || assignInfo.Title || 'ä½œä¸šè¯¦æƒ…');
                
                let html = '';
                
        // 1. ä½œä¸šä¿¡æ¯å¡ç‰‡ - æ•™å¸ˆæ‰¹æ”¹ä¸“ç”¨ç‰ˆ
                html += `
                <div class="assignment-info-card" style="background: linear-gradient(135deg, #f5f7fa, #e4e8f0); border-left: 6px solid #673ab7; box-shadow: 0 4px 12px rgba(103, 58, 183, 0.15);">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="background: #673ab7; color: white; width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; box-shadow: 0 4px 8px rgba(103, 58, 183, 0.3);">
                                ğŸ‘¨â€ğŸ«
                            </div>
                            <div style="flex: 1;">
                                <h4 style="margin: 0; color: #2d3436; font-size: 24px; font-weight: 700;">${assignInfo.title || assignInfo.Title || 'æœªå‘½åä½œä¸š'}</h4>
                                <p style="margin: 5px 0 0; color: #666; font-size: 14px;">æ•™å¸ˆæ‰¹æ”¹è§†å›¾ â€¢ ä½œä¸šID: ${assignInfo.id || assignInfo.ID || 'N/A'}</p>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 12px; color: #666; margin-bottom: 5px;">ğŸ‘¨â€ğŸ« å‘å¸ƒæ•™å¸ˆ</div>
                            <div style="color: #673ab7; font-size: 14px; font-weight: 600;">${assignInfo.teacher_id || assignInfo.TeacherID || 'æœªçŸ¥æ•™å¸ˆ'}</div>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 15px; margin-top: 15px;">
                        <div style="background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.05); border: 1px solid #e0e0e0;">
                            <div style="font-size: 12px; color: #666; margin-bottom: 8px; display: flex; align-items: center; gap: 5px;">
                                <span>ğŸ“‹</span> ä½œä¸šæè¿°
                            </div>
                            <div style="color: #333; font-size: 14px; line-height: 1.5; min-height: 40px;">${assignInfo.description || assignInfo.Description || 'æ— è¯¦ç»†æè¿°'}</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.05); border: 1px solid #e0e0e0;">
                            <div style="font-size: 12px; color: #666; margin-bottom: 8px; display: flex; align-items: center; gap: 5px;">
                                <span>ğŸ“</span> ä½œä¸šç±»å‹
                            </div>
                            <div style="color: #333; font-size: 16px; font-weight: 600;">${assignInfo.type || assignInfo.Type || 'å¸¸è§„'}</div>
                        </div>
                        <div style="background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.05); border: 1px solid #e0e0e0;">
                            <div style="font-size: 12px; color: #666; margin-bottom: 8px; display: flex; align-items: center; gap: 5px;">
                                <span>ğŸ“Š</span> é¢˜ç›®æ•°é‡
                            </div>
                            <div style="color: #333; font-size: 16px; font-weight: 600;">${questions.length} é¢˜</div>
                        </div>
                    </div>
                </div>
                `;
                
        // æ£€æŸ¥ä½œä¸šæˆªæ­¢æ—¶é—´ - å¢å¼ºæ˜¾ç¤ºæ•ˆæœï¼ˆæ•™å¸ˆä¸“ç”¨ï¼‰
        if (assignInfo.deadline) {
            const deadline = new Date(assignInfo.deadline);
            const now = new Date();
            const isExpired = now > deadline;
            
            // è®¡ç®—å‰©ä½™æ—¶é—´
            const timeDiff = deadline - now;
            const daysLeft = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
            const hoursLeft = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutesLeft = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
            
            let timeLeftText = '';
            let timeStatus = '';
            let statusColor = '#28a745';
            
            if (!isExpired) {
                if (daysLeft > 7) {
                    timeLeftText = `å‰©ä½™ ${daysLeft} å¤©`;
                    timeStatus = 'æ—¶é—´å……è£•';
                    statusColor = '#28a745';
                } else if (daysLeft > 3) {
                    timeLeftText = `å‰©ä½™ ${daysLeft} å¤©`;
                    timeStatus = 'æ³¨æ„æ—¶é—´';
                    statusColor = '#ffc107';
                } else if (daysLeft > 0) {
                    timeLeftText = `å‰©ä½™ ${daysLeft} å¤© ${hoursLeft} å°æ—¶`;
                    timeStatus = 'æ—¶é—´ç´§å¼ ';
                    statusColor = '#fd7e14';
                } else if (hoursLeft > 0) {
                    timeLeftText = `å‰©ä½™ ${hoursLeft} å°æ—¶ ${minutesLeft} åˆ†é’Ÿ`;
                    timeStatus = 'å³å°†æˆªæ­¢';
                    statusColor = '#dc3545';
                } else {
                    timeLeftText = `å‰©ä½™ ${minutesLeft} åˆ†é’Ÿ`;
                    timeStatus = 'æœ€åæ—¶åˆ»';
                    statusColor = '#c0392b';
                }
            }
            
            html += `
                <div class="deadline-info ${isExpired ? 'warning' : ''}" 
                     style="${isExpired ? 'background: linear-gradient(135deg, #ffeaa7, #f8c8c8); border-left: 6px solid #e74c3c;' : 
                             `background: linear-gradient(135deg, #e3f2fd, #d1ecf1); border-left: 6px solid ${statusColor};`}">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <span class="deadline-icon" style="font-size: 24px; background: ${isExpired ? '#e74c3c' : statusColor}; color: white; width: 48px; height: 48px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            ${isExpired ? 'â°' : 'â³'}
                        </span>
                        <div style="flex: 1;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                                <strong style="font-size: 16px; color: ${isExpired ? '#c0392b' : '#333'};">
                                    ä½œä¸šæäº¤æˆªæ­¢æ—¶é—´
                                </strong>
                                ${!isExpired ? `<span style="font-weight: bold; color: ${statusColor}; font-size: 14px; padding: 3px 10px; background: white; border-radius: 15px;">${timeStatus}</span>` : ''}
                            </div>
                            <div style="color: ${isExpired ? '#c0392b' : '#555'}; font-size: 15px; line-height: 1.5;">
                                <div><strong>ğŸ“… æˆªæ­¢æ—¶é—´ï¼š</strong>${deadline.toLocaleString('zh-CN')}</div>
                                ${isExpired ? 
                                    '<div style="color: #e74c3c; font-weight: 700; margin-top: 5px;">â›” ä½œä¸šå·²è¿‡æœŸï¼Œå­¦ç”Ÿæ— æ³•æäº¤</div>' : 
                                    `<div style="color: ${statusColor}; font-weight: 600; margin-top: 5px;">â±ï¸ ${timeLeftText}</div>`
                                }
                                <div style="margin-top: 8px; font-size: 13px; color: #666; background: rgba(255,255,255,0.7); padding: 5px 10px; border-radius: 6px;">
                                    <strong>ğŸ‘¨â€ğŸ« æ•™å¸ˆæç¤ºï¼š</strong>${isExpired ? 
                                        'å·²è¿‡æœŸçš„ä½œä¸šå­¦ç”Ÿæ— æ³•æäº¤ï¼Œä½†ä»å¯æŸ¥çœ‹å’Œæ‰¹æ”¹' : 
                                        'æˆªæ­¢æ—¶é—´å‰å­¦ç”Ÿå¯æäº¤ï¼Œè¿‡æœŸåå°†æ— æ³•æäº¤'}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                `;
        }
                
        // 2. æäº¤çŠ¶æ€å¡ç‰‡ - å¢å¼ºæ˜¾ç¤ºæ•ˆæœï¼ˆæ•™å¸ˆä¸“ç”¨ï¼‰
                const isSubmitted = submission && (submission.id || submission.ID || submission.submitted === true);
                if (!isSubmitted) {
                    html += `
                <div class="submission-status-card submission-status-not-submitted" style="border-left: 6px solid #dc3545; background: linear-gradient(to right, #f8d7da, #f5c6cb);">
                    <div class="status-content">
                        <h4 style="color: #dc3545; font-size: 20px; display: flex; align-items: center; gap: 10px; font-weight: 600;">
                            <span style="background: white; width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #dc3545; font-size: 18px;">ğŸš«</span>
                            å­¦ç”Ÿæœªæäº¤ä½œä¸š
                        </h4>
                        <p style="font-size: 15px; color: #721c24; margin-top: 10px; line-height: 1.5;">
                            <strong>ğŸ“‹ çŠ¶æ€åˆ†æï¼š</strong>å­¦ç”Ÿå°šæœªæäº¤æ­¤ä½œä¸š<br>
                            <strong>â° æäº¤æœŸé™ï¼š</strong>æˆªæ­¢æ—¶é—´å‰å¯æäº¤ï¼Œè¿‡æœŸåå°†æ— æ³•æäº¤<br>
                            <strong>ğŸ‘¨â€ğŸ« æ•™å¸ˆæç¤ºï¼š</strong>è¯·æé†’å­¦ç”ŸæŒ‰æ—¶å®Œæˆä½œä¸š
                        </p>
                    </div>
                    <div class="score-display score-not-submitted" style="background: #dc3545; color: white; font-size: 24px; font-weight: 700; box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);">
                        æœªæäº¤
                    </div>
                </div>
                `;
                } else {
                    // åˆ¤æ–­çŠ¶æ€ç±»å‹
                    let statusClass = 'submission-status-submitted';
                    let scoreClass = 'score-submitted';
                    let statusText = 'ğŸ“¤ ä½œä¸šå·²æäº¤';
                    let statusIcon = 'ğŸ“¤';
                    let statusColor = '#4f46e5';
                    let bgGradient = 'linear-gradient(to right, #eef2ff, #e0e7ff)';
                    
                    if (submission.status === 'graded') {
                        statusClass = 'submission-status-graded';
                        scoreClass = 'score-graded';
                        statusText = 'âœ… ä½œä¸šå·²æ‰¹æ”¹';
                        statusIcon = 'âœ…';
                        statusColor = '#10b981';
                        bgGradient = 'linear-gradient(to right, #ecfdf5, #d1fae5)';
                    }
                    
                    html += `
                <div class="submission-status-card ${statusClass}" style="border-left: 6px solid ${statusColor}; background: ${bgGradient};">
                    <div class="status-content">
                        <h4 style="color: ${statusColor}; font-size: 20px; display: flex; align-items: center; gap: 10px; font-weight: 600;">
                            <span style="background: white; width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: ${statusColor}; font-size: 18px;">${statusIcon}</span>
                            ${statusText}
                        </h4>
                        <p style="font-size: 15px; color: #333; margin-top: 10px; line-height: 1.5;">
                            <strong>ğŸ‘¨â€ğŸ“ å­¦ç”Ÿå§“åï¼š</strong> ${submission.student_name || 'æœªçŸ¥å­¦ç”Ÿ'}<br>
                            <strong>â° æäº¤æ—¶é—´ï¼š</strong> ${new Date(submission.created_at || submission.CreatedAt).toLocaleString('zh-CN')}
                            ${submission.updated_at && submission.status === 'graded' ? `<br><strong>ğŸ“ æ‰¹æ”¹æ—¶é—´ï¼š</strong> ${new Date(submission.updated_at).toLocaleString('zh-CN')}` : ''}
                        </p>
                    </div>
                    <div class="score-display ${scoreClass}" style="background: ${statusColor}; color: white; font-size: 28px; font-weight: 700; box-shadow: 0 4px 12px rgba(${statusColor === '#4f46e5' ? '79, 70, 229' : '16, 185, 129'}, 0.3);">
                        ${submission.total_score !== undefined ? `${submission.total_score}/100` : 'å¾…æ‰¹æ”¹'}
                    </div>
                </div>
                `;
                    
                    // 3. AIæ‰¹æ”¹åé¦ˆ
                    if (submission.ai_feedback) {
                        html += `
                <div class="ai-feedback-card">
                    <h4>ğŸ¤– AIæ‰¹æ”¹åé¦ˆ</h4>
                    <div class="feedback-content">${submission.ai_feedback}</div>
                </div>
                `;
                    }
                    
                    // 4. è¯¦ç»†è¯„åˆ†
                    if (submission.detailed_score) {
                        try {
                            const detailedScore = typeof submission.detailed_score === 'string' ? 
                                JSON.parse(submission.detailed_score) : submission.detailed_score;
                            
                            let scoreGrid = '<div class="score-grid">';
                            for (const [category, score] of Object.entries(detailedScore)) {
                                scoreGrid += `
                            <div class="score-item">
                                <div class="score-category">${category}</div>
                                <div class="score-value">${score}åˆ†</div>
                            </div>
                            `;
                            }
                            scoreGrid += '</div>';
                            
                            html += `
                <div class="detailed-score-card">
                    <h4>ğŸ“Š è¯¦ç»†è¯„åˆ†</h4>
                    ${scoreGrid}
                </div>
                `;
                        } catch (e) {
                            console.warn('è§£æè¯¦ç»†è¯„åˆ†å¤±è´¥:', e);
                        }
                    }
                    
                    // æ•™å¸ˆç®¡ç†é¢æ¿ï¼ˆä»…æ•™å¸ˆå¯è§ï¼‰
                    const userRole = getCookie('user_role');
                    const hasSubmission = submission && (submission.id || submission.ID);
                    if (userRole === 'teacher' && hasSubmission) {
                        html += `
                <div class="teacher-management-panel" style="margin-top: 30px; border: 2px solid #9c27b0; border-radius: 12px; padding: 25px; background: linear-gradient(135deg, #f9f4ff, #f3e5f5);">
                    <h4 style="margin: 0 0 20px; color: #9c27b0; font-size: 20px; display: flex; align-items: center; gap: 10px;">
                        <span style="background: #9c27b0; color: white; width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px;">ğŸ‘¨â€ğŸ«</span>
                        æ•™å¸ˆç®¡ç†é¢æ¿
                    </h4>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 25px;">
                        <!-- åˆ†æ•°ç®¡ç† -->
                        <div class="teacher-action-card" style="background: white; border-radius: 10px; padding: 20px; box-shadow: 0 3px 10px rgba(0,0,0,0.08); border-left: 4px solid #4caf50;">
                            <h5 style="margin: 0 0 15px; color: #4caf50; font-size: 16px; display: flex; align-items: center; gap: 8px;">
                                <span>ğŸ“Š</span> æ‰‹åŠ¨è°ƒæ•´åˆ†æ•°
                            </h5>
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <input type="number" id="manualScoreInput" min="0" max="100" value="${submission.total_score || 0}" 
                                       style="flex: 1; padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px; text-align: center;"
                                       onchange="updateScoreDisplay(this.value)">
                                <span id="scoreDisplay" style="font-size: 24px; font-weight: bold; color: #4caf50; min-width: 60px;">${submission.total_score || 0}</span>
                            </div>
                            <button onclick="updateSubmissionScore('${submission.id || submission.ID}')" 
                                    style="margin-top: 15px; width: 100%; background: linear-gradient(135deg, #4caf50, #2e7d32); color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.2s;">
                                æ›´æ–°åˆ†æ•°
                            </button>
                            <p style="margin-top: 10px; font-size: 12px; color: #666; line-height: 1.4;">
                                <strong>æç¤ºï¼š</strong>AIæ‰¹æ”¹åˆ†æ•°ä»…ä¾›å‚è€ƒï¼Œæ•™å¸ˆå¯æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´
                            </p>
                        </div>
                        
                        <!-- æ•™å¸ˆæ‰¹æ³¨ -->
                        <div class="teacher-action-card" style="background: white; border-radius: 10px; padding: 20px; box-shadow: 0 3px 10px rgba(0,0,0,0.08); border-left: 4px solid #ff9800;">
                            <h5 style="margin: 0 0 15px; color: #ff9800; font-size: 16px; display: flex; align-items: center; gap: 8px;">
                                <span>âœï¸</span> æ•™å¸ˆæ‰¹æ³¨
                            </h5>
                            <textarea id="teacherFeedbackText" placeholder="è¾“å…¥æ‚¨çš„æ‰¹æ³¨å’Œå»ºè®®..." 
                                      style="width: 100%; height: 100px; padding: 12px; border: 2px solid #ff9800; border-radius: 8px; font-size: 14px; resize: vertical; margin-bottom: 15px;">${submission.teacher_feedback || ''}</textarea>
                            <button onclick="updateTeacherFeedback('${submission.id || submission.ID}')" 
                                    style="width: 100%; background: linear-gradient(135deg, #ff9800, #f57c00); color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.2s;">
                                ä¿å­˜æ‰¹æ³¨
                            </button>
                        </div>
                        
                        <!-- å…¶ä»–æ“ä½œ -->
                        <div class="teacher-action-card" style="background: white; border-radius: 10px; padding: 20px; box-shadow: 0 3px 10px rgba(0,0,0,0.08); border-left: 4px solid #2196f3;">
                            <h5 style="margin: 0 0 15px; color: #2196f3; font-size: 16px; display: flex; align-items: center; gap: 8px;">
                                <span>âš™ï¸</span> å…¶ä»–æ“ä½œ
                            </h5>
                            <div style="display: flex; flex-direction: column; gap: 12px;">
                                <button onclick="regradeSubmission('${submission.id || submission.ID}')" 
                                        style="width: 100%; background: linear-gradient(135deg, #2196f3, #1976d2); color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.2s;">
                                    ğŸ¤– é‡æ–°è§¦å‘AIæ‰¹æ”¹
                                </button>
                                ${submission.code && submission.code.trim() ? `
                                <button onclick="downloadStudentCode('${submission.id || submission.ID}')" 
                                        style="width: 100%; background: linear-gradient(135deg, #9c27b0, #7b1fa2); color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.2s;">
                                    ğŸ’¾ ä¸‹è½½å­¦ç”Ÿä»£ç 
                                </button>
                                ` : ''}
                            </div>
                            <p style="margin-top: 15px; font-size: 12px; color: #666; line-height: 1.4;">
                                <strong>æ³¨æ„ï¼š</strong>é‡æ–°æ‰¹æ”¹å°†è¦†ç›–ç°æœ‰AIåé¦ˆï¼Œä½†ä¿ç•™æ•™å¸ˆæ‰¹æ³¨
                            </p>
                        </div>
                    </div>
                    
                    <!-- æ“ä½œç»“æœæç¤º -->
                    <div id="teacherActionResult" style="margin-top: 20px; padding: 15px; border-radius: 8px; display: none;"></div>
                </div>
                `;
                    }
                }
                
        // æ£€æŸ¥å­¦ç”Ÿæ˜¯å¦æäº¤äº†ä½œä¸š
        const hasSubmission = submission.submitted === true;
                
        // 5. é¢˜ç›®å¯¹æ¯”åŒºåŸŸï¼ˆæ•™å¸ˆç‰ˆæœ¬ï¼šæ˜¾ç¤ºæ ‡å‡†ç­”æ¡ˆå’Œå­¦ç”Ÿç­”æ¡ˆå¯¹æ¯”ï¼‰
        if (questions.length > 0) {
            html += '<div class="questions-section"><h4>ğŸ“‹ é¢˜ç›®è¯¦æƒ…ä¸ç­”æ¡ˆå¯¹æ¯”</h4>';
            
            // è§£æå­¦ç”Ÿç­”æ¡ˆï¼ˆå¦‚æœå­¦ç”Ÿå·²æäº¤ï¼‰
            let studentAnswers = {};
            if (hasSubmission && submission.answers) {
                if (typeof submission.answers === 'object') {
                    studentAnswers = submission.answers;
                } else if (typeof submission.answers === 'string') {
                    try {
                        studentAnswers = JSON.parse(submission.answers);
                    } catch (e) {
                        console.warn('è§£æå­¦ç”Ÿç­”æ¡ˆå¤±è´¥:', e);
                    }
                }
            }
            
            questions.forEach((q, i) => {
                const questionId = q.id || q.ID;
                const studentAnswer = questionId ? studentAnswers[questionId] : '';
                const correctAnswer = q.answer || q.Answer;
                const questionType = q.type || q.Type || 'æœªçŸ¥ç±»å‹';
                const questionScore = q.score || q.Score || 0;
                
                // åˆ¤æ–­ç­”æ¡ˆæ˜¯å¦æ­£ç¡®ï¼ˆä»…å½“å­¦ç”Ÿå·²æäº¤ä¸”æœ‰ç­”æ¡ˆæ—¶ï¼‰
                const isCorrect = hasSubmission && studentAnswer && correctAnswer && 
                                 studentAnswer.toString().trim() === correctAnswer.toString().trim();
                
                html += `
                <div class="question-item">
                    <div class="question-header">
                        <div>
                            <h5>é¢˜ç›® ${i+1} (${questionType})</h5>
                            <p style="font-size: 14px; color: #666; margin: 5px 0 0;">${q.content || q.Content}</p>
                        </div>
                        <div style="text-align: right;">
                            <span class="question-score">${questionScore}åˆ†</span>
                            ${hasSubmission && studentAnswer ? `
                                <div style="margin-top: 5px; font-size: 12px; padding: 2px 8px; border-radius: 4px; 
                                            background: ${isCorrect ? '#d4edda' : '#f8d7da'}; 
                                            color: ${isCorrect ? '#155724' : '#721c24'}">
                                    ${isCorrect ? 'âœ“ æ­£ç¡®' : 'âœ— é”™è¯¯'}
                                </div>
                            ` : ''}
                        </div>
                    </div>
                    
                    <div class="answers-grid">
                        <div class="answer-card student-answer-card">
                            <div class="answer-label">
                                ğŸ“ å­¦ç”Ÿç­”æ¡ˆ
                                ${!hasSubmission ? '<span style="color: #999; font-size: 12px; margin-left: 5px;">(æœªæäº¤ä½œä¸š)</span>' : 
                                  !studentAnswer ? '<span style="color: #999; font-size: 12px; margin-left: 5px;">(æœªä½œç­”)</span>' : ''}
                            </div>
                            <div class="answer-content student-answer-content" style="${isCorrect ? 'color: #28a745; font-weight: 500;' : 'color: #dc3545;'}">
                                ${hasSubmission ? (studentAnswer || 'æœªä½œç­”') : 'å­¦ç”Ÿæœªæäº¤ä½œä¸š'}
                            </div>
                        </div>
                        
                        <div class="answer-card correct-answer-card">
                            <div class="answer-label">âœ… æ ‡å‡†ç­”æ¡ˆ</div>
                            <div class="answer-content correct-answer-content">
                                ${correctAnswer || 'æ— æ ‡å‡†ç­”æ¡ˆ'}
                            </div>
                        </div>
                    </div>
                    
                    ${hasSubmission && studentAnswer && !isCorrect ? `
                    <div style="margin-top: 10px; padding: 10px; background: #fff3cd; border-radius: 6px; border-left: 3px solid #ffc107;">
                        <div style="font-size: 13px; color: #856404;">
                            <strong>åˆ†æï¼š</strong>å­¦ç”Ÿç­”æ¡ˆä¸æ ‡å‡†ç­”æ¡ˆä¸ä¸€è‡´
                        </div>
                    </div>
                    ` : ''}
                    
                    <!-- æ•™å¸ˆå¯¹æ¯ä¸ªé¢˜ç›®çš„å•ç‹¬æ‰¹æ”¹ -->
                    ${userRole === 'teacher' && hasSubmission ? `
                    <div class="teacher-question-grading" style="margin-top: 20px; padding: 20px; background: linear-gradient(135deg, #f9f4ff, #f3e5f5); border-radius: 10px; border: 2px solid #9c27b0;">
                        <h6 style="margin: 0 0 15px; color: #9c27b0; font-size: 15px; display: flex; align-items: center; gap: 8px;">
                            <span style="background: #9c27b0; color: white; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px;">ğŸ‘¨â€ğŸ«</span>
                            æ•™å¸ˆå•ç‹¬æ‰¹æ”¹ - é¢˜ç›® ${i+1}
                        </h6>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-size: 13px; color: #555; font-weight: 500;">é¢˜ç›®åˆ†æ•° (0-${questionScore}åˆ†)</label>
                                <input type="number" id="questionScore_${questionId}" 
                                       min="0" max="${questionScore}" 
                                       value="${getQuestionScore(submission, questionId) || 0}"
                                       style="width: 100%; padding: 10px; border: 2px solid #9c27b0; border-radius: 8px; font-size: 16px; text-align: center;"
                                       onchange="updateQuestionScoreDisplay('${questionId}', this.value, ${questionScore})">
                                <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                                    <span id="questionScoreDisplay_${questionId}" 
                                          style="font-size: 20px; font-weight: bold; color: #4caf50;">
                                        ${getQuestionScore(submission, questionId) || 0}
                                    </span>
                                    <span style="font-size: 12px; color: #666;">/ ${questionScore}åˆ†</span>
                                </div>
                            </div>
                            
                            <div>
                                <button onclick="saveQuestionGrade('${submission.id || submission.ID}', '${questionId}', '${questionScore}')" 
                                        style="width: 100%; background: linear-gradient(135deg, #4caf50, #2e7d32); color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.2s; margin-top: 25px;">
                                    ä¿å­˜æœ¬é¢˜è¯„åˆ†
                                </button>
                            </div>
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 5px; font-size: 13px; color: #555; font-weight: 500;">æ•™å¸ˆæ‰¹æ³¨</label>
                            <textarea id="questionFeedback_${questionId}" 
                                      placeholder="é’ˆå¯¹æœ¬é¢˜çš„æ‰¹æ³¨å’Œå»ºè®®..."
                                      style="width: 100%; height: 80px; padding: 10px; border: 2px solid #ff9800; border-radius: 8px; font-size: 13px; resize: vertical;">${getQuestionFeedback(submission, questionId) || ''}</textarea>
                            <button onclick="saveQuestionFeedback('${submission.id || submission.ID}', '${questionId}')" 
                                    style="width: 100%; background: linear-gradient(135deg, #ff9800, #f57c00); color: white; border: none; padding: 10px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.2s; margin-top: 10px;">
                                ä¿å­˜æœ¬é¢˜æ‰¹æ³¨
                            </button>
                        </div>
                        
                        <div id="questionActionResult_${questionId}" style="margin-top: 10px; padding: 10px; border-radius: 6px; display: none;"></div>
                    </div>
                    ` : ''}
                </div>
                `;
            });
            
            html += '</div>';
        }
                
                // 6. ä»£ç å†…å®¹ï¼ˆå¦‚æœæœ‰ï¼‰
                if (submission.code && submission.code.trim()) {
                    const formattedCode = formatCode(submission.code, 'go');
                    html += `
                <div class="code-section">
                    <h4>ğŸ’» å­¦ç”Ÿä»£ç </h4>
                    <pre class="code-content">${formattedCode}</pre>
                </div>
                `;
                } else if (hasSubmission) {
                    html += `
                <div class="code-section">
                    <h4>ğŸ’» å­¦ç”Ÿä»£ç </h4>
                    <pre class="code-content" style="color: #999; font-style: italic;">å­¦ç”Ÿæœªæä¾›ä»£ç </pre>
                </div>
                `;
                }
                
                body.innerHTML = html;
            } catch (e) {
                body.innerHTML = '<div style="color:red; text-align:center; padding:40px;">è¯¦æƒ…åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–åç«¯æ¥å£ã€‚</div>';
                console.error("Detail Error:", e);
            }
        }

        function closeModal() {
            document.getElementById('assignmentModal').style.display = 'none';
        }

        // é¡µé¢åˆå§‹åŒ–
        async function init() {
            const params = new URLSearchParams(window.location.search);
            const studentId = params.get('studentId');
            
            if (!studentId) {
                document.body.innerHTML = '<div style="text-align:center; padding:50px;">é”™è¯¯ï¼šURLä¸­ç¼ºå°‘ studentId å‚æ•°</div>';
                return;
            }

            try {
                const response = await fetch(`/api/students/${studentId}/assignments`, {
                    headers: {
                        'X-User-ID': getCookie('user_id'),
                        'X-User-Role': getCookie('user_role')
                    }
                });
                
                if (!response.ok) throw new Error("APIå“åº”é”™è¯¯");
                
                const data = await response.json();
                console.log("æ¥å£è¿”å›åŸå§‹æ ¹æ•°æ®:", data);
                
                // å…¼å®¹å¤šå±‚çº§æ•°æ®ç»“æ„
                currentStudent = data.student || data.Student || (data.data && (data.data.student || data.data.Student));
                currentAssignments = data.assignments || data.Assignments || (data.data && (data.data.assignments || data.data.Assignments));

                renderStudentInfo();
                renderAssignments();
            } catch (e) {
                console.error("Init Error:", e);
                document.getElementById('studentName').textContent = "æ•°æ®åŠ è½½å¤±è´¥";
            }
        }

        // æ›´æ–°åˆ†æ•°æ˜¾ç¤º
        function updateScoreDisplay(value) {
            const scoreDisplay = document.getElementById('scoreDisplay');
            if (scoreDisplay) {
                scoreDisplay.textContent = value;
                scoreDisplay.style.color = value >= 90 ? '#10b981' : 
                                        value >= 80 ? '#4f46e5' : 
                                        value >= 60 ? '#f59e0b' : '#ef4444';
            }
        }

        // æ›´æ–°æäº¤åˆ†æ•°
        async function updateSubmissionScore(submissionId) {
            const scoreInput = document.getElementById('manualScoreInput');
            const score = parseInt(scoreInput.value);
            
            if (isNaN(score) || score < 0 || score > 100) {
                showActionResult('è¯·è¾“å…¥0-100ä¹‹é—´çš„æœ‰æ•ˆåˆ†æ•°', 'error');
                return;
            }
            
            try {
                const response = await fetch(`/api/submissions/${submissionId}/score`, {
                    method: 'PUT',
                    headers: {
                        'X-User-ID': getCookie('user_id'),
                        'X-User-Role': getCookie('user_role'),
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ score: score })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                showActionResult('åˆ†æ•°æ›´æ–°æˆåŠŸï¼', 'success');
                // æ›´æ–°æ˜¾ç¤º
                updateScoreDisplay(score);
            } catch (error) {
                console.error('æ›´æ–°åˆ†æ•°å¤±è´¥:', error);
                showActionResult('åˆ†æ•°æ›´æ–°å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
            }
        }

        // æ›´æ–°æ•™å¸ˆæ‰¹æ³¨
        async function updateTeacherFeedback(submissionId) {
            const feedbackTextarea = document.getElementById('teacherFeedbackText');
            const feedback = feedbackTextarea.value.trim();
            
            if (!feedback) {
                showActionResult('è¯·è¾“å…¥æ‰¹æ³¨å†…å®¹', 'warning');
                return;
            }
            
            try {
                const response = await fetch(`/api/submissions/${submissionId}/feedback`, {
                    method: 'PUT',
                    headers: {
                        'X-User-ID': getCookie('user_id'),
                        'X-User-Role': getCookie('user_role'),
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ feedback: feedback })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                showActionResult('æ‰¹æ³¨ä¿å­˜æˆåŠŸï¼', 'success');
            } catch (error) {
                console.error('ä¿å­˜æ‰¹æ³¨å¤±è´¥:', error);
                showActionResult('æ‰¹æ³¨ä¿å­˜å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
            }
        }

        // é‡æ–°è§¦å‘AIæ‰¹æ”¹
        async function regradeSubmission(submissionId) {
            if (!confirm('ç¡®å®šè¦é‡æ–°è§¦å‘AIæ‰¹æ”¹å—ï¼Ÿè¿™å°†è¦†ç›–ç°æœ‰çš„AIåé¦ˆï¼Œä½†ä¿ç•™æ•™å¸ˆæ‰¹æ³¨ã€‚')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/submissions/${submissionId}/regrade`, {
                    method: 'POST',
                    headers: {
                        'X-User-ID': getCookie('user_id'),
                        'X-User-Role': getCookie('user_role')
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                showActionResult('AIæ‰¹æ”¹å·²é‡æ–°è§¦å‘ï¼Œè¯·ç¨åæŸ¥çœ‹ç»“æœ', 'info');
                // å¼€å§‹è½®è¯¢æŸ¥çœ‹çŠ¶æ€å˜åŒ–
                const studentId = new URLSearchParams(window.location.search).get('studentId');
                const modalBody = document.getElementById('modalBody');
                const assignmentElement = modalBody.querySelector('.assignment-info-card');
                let assignmentId = '';
                if (assignmentElement && assignmentElement.querySelector('h4')) {
                    // å°è¯•ä»é¡µé¢è·å–ä½œä¸šID
                    const titleElement = modalBody.querySelector('#modalTitle');
                    // è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œå®é™…ä¸Šåº”è¯¥ä»å½“å‰æ¨¡æ€æ¡†æ•°æ®ä¸­è·å–assignmentId
                    // é‡æ–°åŠ è½½å½“å‰é¡µé¢æ•°æ®
                    location.reload();
                }
            } catch (error) {
                console.error('é‡æ–°æ‰¹æ”¹å¤±è´¥:', error);
                showActionResult('é‡æ–°æ‰¹æ”¹è¯·æ±‚å¤±è´¥', 'error');
            }
        }

        // ä¸‹è½½å­¦ç”Ÿä»£ç 
        async function downloadStudentCode(submissionId) {
            try {
                const response = await fetch(`/api/submissions/${submissionId}/download`, {
                    headers: {
                        'X-User-ID': getCookie('user_id'),
                        'X-User-Role': getCookie('user_role')
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                // ä»å“åº”å¤´è·å–æ–‡ä»¶åæˆ–ä½¿ç”¨é»˜è®¤åç§°
                const contentDisposition = response.headers.get('Content-Disposition');
                let filename = 'student-code.go';
                if (contentDisposition) {
                    const filenameMatch = contentDisposition.match(/filename="?([^"]+)"?/);
                    if (filenameMatch) {
                        filename = filenameMatch[1];
                    }
                }
                
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                
                showActionResult('ä»£ç ä¸‹è½½æˆåŠŸ', 'success');
            } catch (error) {
                console.error('ä¸‹è½½ä»£ç å¤±è´¥:', error);
                showActionResult('ä»£ç ä¸‹è½½å¤±è´¥', 'error');
            }
        }

        // æ˜¾ç¤ºæ“ä½œç»“æœ
        function showActionResult(message, type = 'info') {
            const resultDiv = document.getElementById('teacherActionResult');
            if (!resultDiv) return;
            
            const colors = {
                success: '#d4edda',
                error: '#f8d7da',
                warning: '#fff3cd',
                info: '#d1ecf1'
            };
            const textColors = {
                success: '#155724',
                error: '#721c24',
                warning: '#856404',
                info: '#0c5460'
            };
            
            resultDiv.style.display = 'block';
            resultDiv.style.backgroundColor = colors[type] || colors.info;
            resultDiv.style.color = textColors[type] || textColors.info;
            resultDiv.style.border = `1px solid ${textColors[type] || textColors.info}30`;
            resultDiv.innerHTML = `
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 18px;">${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : type === 'warning' ? 'âš ï¸' : 'â„¹ï¸'}</span>
                    <span>${message}</span>
                </div>
            `;
            
            // 3ç§’åè‡ªåŠ¨éšè—
            setTimeout(() => {
                resultDiv.style.display = 'none';
            }, 3000);
        }

        // è·å–é¢˜ç›®åˆ†æ•°
        function getQuestionScore(submission, questionId) {
            if (!submission.detailed_score) return 0;
            try {
                const detailedScore = typeof submission.detailed_score === 'string' ? 
                    JSON.parse(submission.detailed_score) : submission.detailed_score;
                return detailedScore[`question_${questionId}`] || detailedScore[questionId] || 0;
            } catch (e) {
                console.warn('è§£æè¯¦ç»†åˆ†æ•°å¤±è´¥:', e);
                return 0;
            }
        }

        // è·å–é¢˜ç›®åé¦ˆ
        function getQuestionFeedback(submission, questionId) {
            if (!submission.teacher_feedback) return '';
            if (typeof submission.teacher_feedback === 'string') {
                try {
                    const feedbackObj = JSON.parse(submission.teacher_feedback);
                    return feedbackObj[questionId] || feedbackObj[`question_${questionId}`] || '';
                } catch (e) {
                    // å¦‚æœä¸æ˜¯JSONæ ¼å¼ï¼Œè¿”å›æ•´ä½“åé¦ˆ
                    return submission.teacher_feedback;
                }
            }
            return '';
        }

        // æ›´æ–°é¢˜ç›®åˆ†æ•°æ˜¾ç¤º
        function updateQuestionScoreDisplay(questionId, value, maxScore) {
            const scoreDisplay = document.getElementById(`questionScoreDisplay_${questionId}`);
            if (scoreDisplay) {
                const score = parseInt(value) || 0;
                scoreDisplay.textContent = score;
                // æ ¹æ®åˆ†æ•°ç™¾åˆ†æ¯”è®¾ç½®é¢œè‰²
                const percentage = (score / maxScore) * 100;
                if (percentage >= 90) {
                    scoreDisplay.style.color = '#10b981';
                } else if (percentage >= 80) {
                    scoreDisplay.style.color = '#4f46e5';
                } else if (percentage >= 60) {
                    scoreDisplay.style.color = '#f59e0b';
                } else {
                    scoreDisplay.style.color = '#ef4444';
                }
            }
        }

        // ä¿å­˜é¢˜ç›®è¯„åˆ†
        async function saveQuestionGrade(submissionId, questionId, maxScore) {
            const scoreInput = document.getElementById(`questionScore_${questionId}`);
            const score = parseInt(scoreInput.value);
            
            if (isNaN(score) || score < 0 || score > maxScore) {
                showQuestionActionResult(questionId, `è¯·è¾“å…¥0-${maxScore}ä¹‹é—´çš„æœ‰æ•ˆåˆ†æ•°`, 'error');
                return;
            }
            
            try {
                const response = await fetch(`/api/submissions/${submissionId}/question/${questionId}/score`, {
                    method: 'PUT',
                    headers: {
                        'X-User-ID': getCookie('user_id'),
                        'X-User-Role': getCookie('user_role'),
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        question_id: questionId,
                        score: score 
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                showQuestionActionResult(questionId, 'é¢˜ç›®è¯„åˆ†ä¿å­˜æˆåŠŸï¼', 'success');
                // æ›´æ–°æ˜¾ç¤º
                updateQuestionScoreDisplay(questionId, score, maxScore);
            } catch (error) {
                console.error('ä¿å­˜é¢˜ç›®è¯„åˆ†å¤±è´¥:', error);
                showQuestionActionResult(questionId, 'é¢˜ç›®è¯„åˆ†ä¿å­˜å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
            }
        }

        // ä¿å­˜é¢˜ç›®åé¦ˆ
        async function saveQuestionFeedback(submissionId, questionId) {
            const feedbackTextarea = document.getElementById(`questionFeedback_${questionId}`);
            const feedback = feedbackTextarea.value.trim();
            
            if (!feedback) {
                showQuestionActionResult(questionId, 'è¯·è¾“å…¥æ‰¹æ³¨å†…å®¹', 'warning');
                return;
            }
            
            try {
                const response = await fetch(`/api/submissions/${submissionId}/question/${questionId}/feedback`, {
                    method: 'PUT',
                    headers: {
                        'X-User-ID': getCookie('user_id'),
                        'X-User-Role': getCookie('user_role'),
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        question_id: questionId,
                        feedback: feedback 
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                showQuestionActionResult(questionId, 'é¢˜ç›®æ‰¹æ³¨ä¿å­˜æˆåŠŸï¼', 'success');
            } catch (error) {
                console.error('ä¿å­˜é¢˜ç›®æ‰¹æ³¨å¤±è´¥:', error);
                showQuestionActionResult(questionId, 'é¢˜ç›®æ‰¹æ³¨ä¿å­˜å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
            }
        }

        // æ˜¾ç¤ºé¢˜ç›®æ“ä½œç»“æœ
        function showQuestionActionResult(questionId, message, type = 'info') {
            const resultDiv = document.getElementById(`questionActionResult_${questionId}`);
            if (!resultDiv) return;
            
            const colors = {
                success: '#d4edda',
                error: '#f8d7da',
                warning: '#fff3cd',
                info: '#d1ecf1'
            };
            const textColors = {
                success: '#155724',
                error: '#721c24',
                warning: '#856404',
                info: '#0c5460'
            };
            
            resultDiv.style.display = 'block';
            resultDiv.style.backgroundColor = colors[type] || colors.info;
            resultDiv.style.color = textColors[type] || textColors.info;
            resultDiv.style.border = `1px solid ${textColors[type] || textColors.info}30`;
            resultDiv.innerHTML = `
                <div style="display: flex; align-items: center; gap: 8px; font-size: 14px;">
                    <span style="font-size: 16px;">${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : type === 'warning' ? 'âš ï¸' : 'â„¹ï¸'}</span>
                    <span>${message}</span>
                </div>
            `;
            
            // 3ç§’åè‡ªåŠ¨éšè—
            setTimeout(() => {
                resultDiv.style.display = 'none';
            }, 3000);
        }

        window.onload = init;
        window.onclick = (e) => { if(e.target.id === 'assignmentModal') closeModal(); }
    </script>
</body>
</html>